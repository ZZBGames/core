language: cpp

compiler:
- gcc

before_install:
- sudo apt-get -qq update
- sudo apt-get install -qq libsfml-dev
- sudo apt-get install -qq libgtest-dev
- sudo apt-get install -qq lcov
- sudo apt-get install -qq ruby
- gem install coveralls-lcov

install:
# Build GTest
- "cd /usr/src/gtest && sudo cmake -DBUILD_SHARED_LIBS=ON . && sudo cmake --build . && sudo cp libgtest* /usr/local/lib ; cd -"

before_script:
- cd ${TRAVIS_BUILD_DIR}
- lcov --directory . --zerocounters

script:
- cd ${TRAVIS_BUILD_DIR}
- cmake -DWITH_CODE_COVERAGE=ON -DBUILD_DOC=OFF .
- make
- make tests

after_success:
- cd ${TRAVIS_BUILD_DIR}
- lcov --directory . --capture --output-file coverage.info
- lcov --remove coverage.info 'test/*' '/usr/*' --output-file coverage.info
- lcov --list coverage.info
- coveralls-lcov --repo-token ${COVERALLS_TOKEN} coverage.info
